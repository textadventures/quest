@using QuestViva.Common

<style scoped>
    .left-pane {
        width: 200px;
        min-width: 150px;
        border-right: 1px solid #ccc;
        overflow-y: auto;
        padding: 10px;
    }

    .left-pane ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .list-item-button {
        width: 100%;
        text-align: left;
        background: none;
        border: none;
        cursor: pointer;
        padding: 6px 8px;
    }

    .list-item-button:hover {
        background-color: #f0f0f0;
    }

    .list-item-button.selected {
        background-color: #007BFF;
        color: #fff;
    }

    .right-pane {
        flex: 1;
        overflow: auto;
        padding: 10px;
    }
</style>

<!-- Left column: object list/tree -->
<div class="left-pane">
    <ul>
        @foreach (var obj in Game.GetObjects(ActiveTab))
        {
            <li>
                <button
                    class="list-item-button @(obj == selectedObject ? "selected" : "")"
                    @onclick="() => OnObjectSelected(obj)">
                    @obj
                </button>
            </li>
        }
    </ul>
</div>

<!-- Right column: attribute table -->
<div class="right-pane">
    <table class="table table-sm">
        <thead>
        <tr>
            <th>Attribute</th>
            <th>Value</th>
            <th>Source</th>
        </tr>
        </thead>
        <tbody>
        @if (selectedObject == null)
        {
            <tr>
                <td colspan="3">Select an object to view its attributes</td>
            </tr>
        }
        else
        {
            foreach (var attr in Game.GetDebugData(selectedObject).Data)
            {
                <tr class="@(attr.Value.IsInherited ? "table-secondary" : "")">
                    <td>@attr.Key</td>
                    <td>@attr.Value.Value</td>
                    <td>@attr.Value.Source</td>
                </tr>
            }
        }
        </tbody>
    </table>
</div>

@code {
    [Parameter] public required IGameDebug Game { get; set; }
    [Parameter] public string ActiveTab { get; set; } = "";
    private string _previousTab = "";

    private string? selectedObject;

    protected override void OnParametersSet()
    {
        if (ActiveTab != _previousTab)
        {
            selectedObject = null;
            _previousTab = ActiveTab;
        }

        base.OnParametersSet();
    }
    
    private void OnObjectSelected(string objName)
    {
        selectedObject = objName;
    }
}