@using QuestViva.EditorCore

<MudTextField T="string"
              Label="@Control.Caption"
              Value="@GetValue()"
              ValueChanged="OnValueChanged"
              Immediate="false"
              DebounceInterval="0"
              Variant="Variant.Outlined"
              Margin="Margin.Dense"/>

@code {
    [Parameter, EditorRequired]
    public IEditorControl Control { get; set; } = null!;

    [Parameter, EditorRequired]
    public IEditorData EditorData { get; set; } = null!;

    [Parameter, EditorRequired]
    public EditorService EditorService { get; set; } = null!;

    private string GetValue()
    {
        if (Control.Attribute == null) return "";
        return EditorData.GetAttribute(Control.Attribute)?.ToString() ?? "";
    }

    private void OnValueChanged(string value)
    {
        if (Control.Attribute == null) return;
        EditorService.StartTransaction($"Change {Control.Caption}");
        EditorData.SetAttribute(Control.Attribute, value);
        EditorService.EndTransaction();
    }
}
