<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Handling ask ... about</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="docs.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Quest Documentation</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li ><a href="index.html">Home</a></li>
            <li ><a href="tutorial/index.html">Tutorial</a></li>
            <li ><a href="http://docs.textadventures.co.uk/quest/scripts/">Scripts</a></li>
            <li ><a href="functions/index.html">Functions</a></li>
            <li ><a href="attributes.html">Attributes</a></li>
            <li><a href="http://textadventures.co.uk/forum">Forum</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <h1>Handling ask ... about</h1>
      <p>Interactive fiction has broadly three ways for the player to talk to NPCs.</p>

<blockquote>
  <p>SAY …</p>
</blockquote>

<blockquote>
  <p>TALK TO …</p>
</blockquote>

<blockquote>
  <p>ASK … ABOUT …</p>
</blockquote>

<p>This page is about using ask … about.</p>

<p>This is something built in to Quest, but it does need to be turned on. On the <em>Features</em> tab of the game object, tick the “Ask/Tell” box. You should now find there is an <em>Ask/Tell</em> tab for the objects in your game.</p>

<p>I am just going to focus on ASK on this page, but you will see there is also the capability to do TELL too. It works just the same, so everything here can also be applied to TELL.</p>

<h2 id="ask--about">Ask … about</h2>

<p>The way ASK works is that you give a list of topics and corresponding scripts. Suppose we have a character, Mary, and we want to ask her about the murder of Dr Black. In the ASK section, click <em>Add</em>, and then type in the topic, “dr black”. Click <em>Okay</em>, and then add the script that will run when the player asks about Dr Black. For now, just have it print a simple message.</p>

<p>Now go in game, and type ASK MARY ABOUT DR BLACK, and you should see your message. Quest will do its best to match topics, so you should also see the message if you type ASK MARY ABOUT DR or ASK MARY ABOUT BLACK. Ah, but what if the player types ASK MARY ABOUT DOCTOR BLACK? Go back to the <em>Ask/Tell</em> tab for Mary, make sure this topic is selected and click on “Edit Key”. Replace “dr black” with “dr doctor black”.</p>

<p>What Quest does is attempt to match the topic against each word in the topic’s key, rather than exactly matching the whole thing, so you can put a list of keywords here, separated by spaces.</p>

<p>Obviously you can change the script that runs by selecting the topic and clicking “Edit Script”. However, I am not going to worry about that in this tutorial.</p>

<h2 id="more-advanced">More advanced…</h2>

<p>We can make this system more sophisticated in a number of ways. However, we will be using code to do that. Why? Well, it is easier for me to show you, but it is easier for you to put in your game, as you can just copy-and-paste the code. We will keep it simple, and let you know what you need to change for your game, and what can be pasted in without any changes.</p>

<p>For more on how to copy-and-paste code, see <a href="copy_and_paste_code.html">here</a>.</p>

<h2 id="default-replies">Default replies</h2>

<p>Underneath the list of ASK topics, you can put a script to run when there is no topic for this character. Perhaps for Mary we could print a message that says “She looks at you, wondering what you are talking about.”</p>

<p>As of Quest 5.7, you can use a special variable, “text”, which will contain the subject the player was asking about. You could have something like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msg("Mary shrugs, and says, 'I know nothing about " + text + ".'")
</code></pre></div></div>

<h2 id="topics">Topics</h2>

<p>It can be frustrating for the player to have to guess what topics are available, so an option is to provide a TOPICS command, which simply lists the topics the player can ask about. The best way to do this is to set up a string with some initial entries, and then to add to it as the game progresses. In the investigation of the murder of Dr Black, new topics could be added as new evidence comes to light, for instance.</p>

<p>Note that this assumes all NPCs will have the same topics available. I think it likely that the player will assume that if she can ask Mary about Dr Black, she can ask any other character too. This does mean you will need to add all these topics to all the NPCs.</p>

<p>The first step, then, is to create our string list. If using the off-line editor, go to the <em>Attributes</em> tab of the game object, and create a new attribute called “topics”. Set it to be a string list, and add names of any topics that will be available from the start.</p>

<p>If using the on-line editor, you will have to add the attribute in a script. Go to the <em>Scripts</em> tab of the game object, and add this to the start script (this will set “Job” and “Alibi” as topics from the start):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>game.topics = Split("Job;Alibi", ";")
</code></pre></div></div>
<p>This will be shown to the player, so capitalise it nicely and bear in mind it needs to fit the ASK … ABOUT … format. Also, it makes the script for the topics command easier if there are at least two topics from the start.</p>

<p>Now we need to create a new command. Go to <em>Commands</em> in the left pane, then click “Add” in the right pane. For the command pattern, type in “topics”, and paste in this code:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msg ("Topics you might want to ask about include:")
foreach (s, game.topics) {
  msg (s)
}
</code></pre></div></div>
<p>You can add to the list of topics at any time during the game, as the plot develops. For example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>list add(game.topics, "Forensic results")
</code></pre></div></div>

<h2 id="ask-about-">Ask about …</h2>

<p>If there is only one NPC in the room, we can save the player some typing by creating an ASK ABOUT … command. Go to <em>Commands</em> in the left pane, then click “Add” in the right pane. For the command pattern, type in “ask about #text#”, and paste in this code:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npcs = NewObjectList()
opts = NewStringDictionary()
foreach (o, GetDirectChildren(player.parent)) {
  if (HasAttribute(o, "ask")) {
    list add (npcs, o)
    dictionary add (opts, o.name, GetDisplayAlias(o))
  }
}
if (ListCount(npcs) = 0) {
  msg ("You can ask, but no one is here to tell you anything.")
}
else if (ListCount(npcs) = 1) {
  DoAskTell (ObjectListItem(npcs, 0), text, "ask", "askdefault", "DefaultAsk")
}
else {
  game.askabouttext = text
  ShowMenu ("Ask who?", opts, true) {
    if (not result = null) {
      o = GetObject(result)
      DoAskTell (o, game.askabouttext, "ask", "askdefault", "DefaultAsk")
    }
  }
}
</code></pre></div></div>
<p>What the code does is firstly go through all the objects in the current room (which it gets using <code class="highlighter-rouge">GetDirectChildren(player.parent)</code>), and collects up all those with an “ask” attribute (this is where Quest stores the topics we set earlier, so this is a good test of whether the object is a character).</p>

<p>Then it looks at how many NPCs it found. If none, an error message; if one, then it calls the same function that the built-in ask/tell system uses, <code class="highlighter-rouge">DoAskTell</code>, using the one NPC it found.</p>

<p>If it found more than one, it will show a menu, asking the player to select one, and then again call <code class="highlighter-rouge">DoAskTell</code>.</p>

<h2 id="ask-">Ask …</h2>

<p>A further option we could give the player is to ask a character, and then offer a list of topics to ask about. We already have the list of topics from the TOPICS command, so half the work is done.</p>

<p>Go to <em>Commands</em> in the left pane, the click “Add” in the right pane. For the command pattern, type in “ask #object#”, and paste in this code:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>game.askaboutobject = object
ShowMenu ("Ask about?", game.topics, true) {
  if (not result = null) {
    DoAskTell (game.askaboutobject, result, "ask", "askdefault", "DefaultAsk")
  }
}
</code></pre></div></div>
<p>It is even more important that every NPC have a response to all the topics now.</p>


      <div class="footer">
        <hr/>
        <a href="http://textadventures.co.uk/"><img src="logo.png"/></a>
      </div>
    </div>

  </body>
</html>
